--INSERT DATA INTO CITY--
INSERT INTO CITY VALUES(50000,'Kuala Lumpur','Wilayah Persekutuan');
INSERT INTO CITY VALUES(40100,'Shah Alam','Selangor');
INSERT INTO CITY VALUES(80000,'Johor Bahru','Johor');
INSERT INTO CITY VALUES(11900,'Bayan Lepas','Penang');
INSERT INTO CITY VALUES(10300,'George Town','Penang');
INSERT INTO CITY VALUES(93300,'Kuching','Sarawak');
INSERT INTO CITY VALUES(98000,'Miri','Sarawak');
INSERT INTO CITY VALUES(25000,'Kuantan','Pahang');
INSERT INTO CITY VALUES(30000,'Ipoh','Perak');
INSERT INTO CITY VALUES(01000,'Kangar','Perlis');
INSERT INTO CITY VALUES(15200,'Kota Bharu','Kelantan');

--SEQUENCE FOR WAREHOUSE ID--
CREATE SEQUENCE WAREHOUSE_ID_SEQ
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;

--SEQUENCE FOR EMPLOYEE ID--
CREATE SEQUENCE EMPLOYEE_ID_SEQ
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;

--WHS_OPEN AND WHS_CLOSE NEED TO CHANGE DATATYPE--

--PROCEDURE TO INSERT WAREHOUSE DATA--
CREATE OR REPLACE PROCEDURE INSERT_WAREHOUSE(
    WHS_NAME IN VARCHAR2,
    WHS_ADDR IN VARCHAR2,
    WHS_OPEN IN TIMESTAMP,
    WHS_CLOSE IN TIMESTAMP,
    POSTCODE IN NUMBER
)
AS
    V_WHS_ID CHAR(5);
BEGIN
    SELECT 'W' || LPAD(WAREHOUSE_ID_SEQ.NEXTVAL, 4, '0') INTO V_WHS_ID FROM DUAL;

    INSERT INTO WAREHOUSE(WHS_ID, WHS_NAME, WHS_ADDR, WHS_OPEN, WHS_CLOSE, POSTCODE)
    VALUES(V_WHS_ID, WHS_NAME, WHS_ADDR, WHS_OPEN, WHS_CLOSE, POSTCODE);
END;

--INSERT DATA INTO WAREHOUSE--
EXEC INSERT_WAREHOUSE('Central Concrete','No. 1, Jalan Sultan Ismail, Kuala Lumpur',TO_TIMESTAMP('08:00','HH24:MI'),TO_TIMESTAMP('18:00','HH24:MI'),50000);
EXEC INSERT_WAREHOUSE('Eco Brick Supplies','No. 23, Taman Ungku Tun Aminah, Johor Bahru',TO_TIMESTAMP('08:30','HH24:MI'),TO_TIMESTAMP('16:30','HH24:MI'),80000);
EXEC INSERT_WAREHOUSE('Steel Framework Hub','No. 45, Lebuh Farquhar, George Town',TO_TIMESTAMP('09:00','HH24:MI'),TO_TIMESTAMP('18:00','HH24:MI'),10300);
EXEC INSERT_WAREHOUSE('Insulation Solutions','Jalan Kuantan-Gambang, Kuantan',TO_TIMESTAMP('08:00','HH24:MI'),TO_TIMESTAMP('16:30','HH24:MI'),25000);
EXEC INSERT_WAREHOUSE('Sustainable Roofing','Bayan Lepas Industrail Park, 11900 Bayan Lepas',TO_TIMESTAMP('07:30','HH24:MI'),TO_TIMESTAMP('18:00','HH24:MI'),93300);

--TRIGGER TO CHECK TIN number IGxxxxxxxxx--
CREATE OR REPLACE TRIGGER TIN_CHECK
BEFORE INSERT OR UPDATE OF EMP_TIN ON EMPLOYEE
FOR EACH ROW
BEGIN
    IF NOT REGEXP_LIKE(:NEW.EMP_TIN, 'IG\d{9,11}$') THEN
        RAISE_APPLICATION_ERROR(-20001, 'TIN number must start with IG followed by 9 to 11 digits');
    END IF;
END;

--PROCEDURE TO INSERT EMPLOYEE DATA--
CREATE OR REPLACE PROCEDURE INSERT_EMPLOYEE(
    EMP_PW IN VARCHAR,
    EMP_TIN IN VARCHAR,
    EMP_IC IN CHAR,
    EMP_FNAME IN VARCHAR2,
    EMP_LNAME IN VARCHAR2,
    EMP_ROLE IN VARCHAR2,
    EMP_TITLE IN VARCHAR2,
    EMP_BDATE IN DATE,
    EMP_PHONE IN VARCHAR2,
    EMP_EMAIL IN VARCHAR2,
    WHS_ID IN CHAR
)
AS
    V_EMP_ID CHAR(5);
BEGIN
    SELECT 'E' || LPAD(EMPLOYEE_ID_SEQ.NEXTVAL, 4, '0') INTO V_EMP_ID FROM DUAL;

    INSERT INTO EMPLOYEE(EMP_ID, EMP_PW, EMP_TIN, EMP_IC, EMP_FNAME, EMP_LNAME, EMP_ROLE, EMP_TITLE, EMP_BDATE, EMP_PHONE, EMP_EMAIL, WHS_ID)
    VALUES(V_EMP_ID, EMP_PW, EMP_TIN, EMP_IC, EMP_FNAME, EMP_LNAME, EMP_ROLE, EMP_TITLE, EMP_BDATE, EMP_PHONE, EMP_EMAIL, WHS_ID);
END;

--INSERT DATA INTO EMPLOYEE--
--EMAIL DATATYPE NEED TO CHANGE TO VARCHAR2(30)--
EXEC INSERT_EMPLOYEE ('pw123456','IG50012345078','900101-14-1234','Ahmad','Ali','Manager','Mr.',TO_DATE('1990-01-01','YYYY-MM-DD'),'6012-345 6789','ahmad@gmail.com','W0001');
EXEC INSERT_EMPLOYEE ('secure456','IG50098765630','920202-02-2345','Siti','Zainab','Supervisor','Ms.',TO_DATE('1992-02-02','YYYY-MM-DD'),'6019-876 5432','siti@gmail.com','W0002');
EXEC INSERT_EMPLOYEE ('concrete123','IG50045678290','910303-10-3456','Lim','Wei','Warehouse Operator','Mr.',TO_DATE('1991-03-03','YYYY-MM-DD'),'6014-567 8901','lim@gmail.com','W0003');
EXEC INSERT_EMPLOYEE ('bricks888','IG50011223740','890404-08-4567','Kumar','Nathan','Delivery Personnel','Mr.',TO_DATE('1989-04-04','YYYY-MM-DD'),'6012-233 4455','kumar@gmail.com','W0004');
EXEC INSERT_EMPLOYEE ('steel999','IG50033445560','870505-06-5678','Nurul','Hidayah','Quality Inspector','Ms.',TO_DATE('1987-05-05','YYYY-MM-DD'),'6019-988 7766','nurul@gmail.com','W0005');